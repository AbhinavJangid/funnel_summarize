### devrev-sdk-typescript

# Consult [USER_README.md](https://github.com/devrev/devrev-sdk-typescript/blob/main/USER_README.md) for Usage instructions and examples

## SDK Generation
In order to make sure you have the correct dependencies installed, run the following command to install the correct versions mentioned in package.json 
```
npm ci
```

`sync_api_contract.sh` is the script which fetches the latest OpenAPI specs from the gateway repo, and generates the i) Public SDK for Public APIs 2) Beta SDK for Beta APIs 3) Internal SDK for internal APIs.

Code in this repo [specially those exposed via the SDK] must comply with the style guideline below: https://google.github.io/styleguide/tsguide.html

## Authorization

Setup an env variable "DEVREV_SDK_TOKEN" It will be used as an auth token by default, You can also pass in the url and token in client.setup()

To run main.ts, do:

```
npm run start:watch
```

Example Usage of the Public SDK

```
const devrevSDK = client.setup();
(async () => {
    const response = await devrevSDK.worksGet({
        id: 'don:core:dvrv-us-1:devo/1DYPnPy0f:issue/8',
    });

    console.info(response.data.work.title);
})();
```

## Run tests:
Please be sure to export `TOKEN` and `ENDPOINT` before running the tests
```
npm test
```

Check package.json for more options

#To setup the client:

```
import * as sdk from '../auto-generated/public-devrev-sdk';
import * as client from "../client_setup";

const devrevSDK = client.setup()
const betaSDK = client.setupBeta()
```

Examples how to create a work item can be found in tests/works.ts

## Create a new test:

[Jest Documentation](https://jestjs.io/docs/expect)

- Add a new test file in src/tests/ directory that contains the necessary functions for your tests.
- To the file src/tests/test.ts add the test itself

**Example test pipeline for works.ts:**

1. Prepare the environment (get the user, create a part and a tag) in init()
2. For /works.create endpoint in worksCreateGet create a work item, try getting it.
   - Assert the correctness of both calls by expect():
     - We check that responses have status 200 or 201, and that the data persists if compared to hard-coded and getResponse.
3. Repeat for other API endpoints
4. To check the correctness of /works.delete try deleting a work item twice and expect an error (await expect(works.works_delete_get(id)).rejects.toThrow())
5. Cleanup the environment (delete the created part and tag)

## Workflow Support (BETA)

In addition to the API methods provided by this SDK, it also supports running pre-defined workflows which involve a sequence of API calls.

The Workflow class provides methods to execute common workflows or sequences of API calls. For example, creating a ticket or an issue involves looking up users by their email, creating the work item, and associating it with the correct user and part.

For more detailed information on available workflows and how to use them, please refer to the separate `WORKFLOW_README.md` file.
